{% extends 'base.html' %}

{% block content %}
<div class="row">
  <!-- Formulario -->
  <div class="col-md-5">
    <h2>Nueva Recepción</h2>
    <form method="POST" action="{{ url_for('crianza.crianza_page') }}">
      <div class="mb-3">
        <label for="reception_date" class="form-label">Fecha de Recepción</label>
        <input type="date" class="form-control" id="reception_date" name="reception_date" required>
      </div>
      <div class="mb-3">
        <label for="weight_kg" class="form-label">Peso (Kg)</label>
        <input type="number" step="0.01" class="form-control" id="weight_kg" name="weight_kg" required>
      </div>
      <div class="mb-3">
        <label for="brix_degrees" class="form-label">Grados Brix</label>
        <input type="number" step="0.01" class="form-control" id="brix_degrees" name="brix_degrees" required>
      </div>
      <div class="mb-3">
        <label for="ph_value" class="form-label">pH</label>
        <input type="number" step="0.01" class="form-control" id="ph_value" name="ph_value" required>
      </div>
      <div class="mb-3">
        <label for="temperature_celcius" class="form-label">Temperatura (°C)</label>
        <input type="number" step="0.01" class="form-control" id="temperature_celcius" name="temperature_celcius" required>
      </div>
      <div class="mb-3">
        <label for="observations" class="form-label">Observaciones</label>
        <textarea class="form-control" id="observations" name="observations" rows="3" required></textarea>
      </div>
      <button type="submit" class="btn btn-primary">Agregar Recepción</button>
    </form>
  </div>

  <!-- Buscador y lista de recepciones -->
  <div class="col-md-7">
    
    <h2>Buscar Recepciones</h2>
    <!-- Formulario Buscador -->
    <form method="GET" action="{{ url_for('crianza.crianza_page') }}" class="mb-3">
      <div class="row g-2 align-items-center">
        <div class="col-auto">
          <label for="grape_variety" class="col-form-label">Variedad de uva:</label>
        </div>
        <div class="col-auto">
          <input type="text" id="grape_variety" name="grape_variety" value="{{ request.args.get('grape_variety', '') }}" class="form-control" placeholder="Ej: Malbec">
        </div>
        <div class="col-auto">
          <label for="vessel_type" class="col-form-label">Tipo de recipiente:</label>
        </div>
        <div class="col-auto">
          <input type="text" id="vessel_type" name="vessel_type" value="{{ request.args.get('vessel_type', '') }}" class="form-control" placeholder="Ej: Barrica">
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-outline-primary">Filtrar</button>
          <a href="{{ url_for('crianza.crianza_page') }}" class="btn btn-outline-secondary">Limpiar</a>
        </div>
      </div>
    </form>
    <h2>Recepciones Actuales</h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Fecha</th>
          <th>Peso (Kg)</th>
          <th>Grados Brix</th>
          <th>pH</th>
          <th>Temperatura (°C)</th>
          <th>Observaciones</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for r in receptions %}
        <tr>
          <td>{{ r.reception_date.strftime('%Y-%m-%d') }}</td>
          <td>{{ r.weight_kg }}</td>
          <td>{{ r.brix_degrees }}</td>
          <td>{{ r.ph_value }}</td>
          <td>{{ r.temperature_celcius }}</td>
          <td>{{ r.observations }}</td>
          <td>
            <a href="{{ url_for('almacenamiento.edit_reception', reception_id=r.id) }}" class="btn btn-sm btn-warning">Editar</a>
            <form action="{{ url_for('almacenamiento.delete_reception', reception_id=r.id) }}" method="POST" style="display:inline;">
              <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('¿Seguro que querés eliminar esta recepción?');">Eliminar</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7" class="text-center">No se encontraron recepciones.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}